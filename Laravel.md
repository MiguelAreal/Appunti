## Install

- Php: `sudo apt install php`
- Nodejs: `sudo apt install nodejs`
- Npm: `sudo apt install npm`
- MySql: `sudo apt install mysql-server`

#### Set Php version
```` bash
sudo apt install php8.0 #Install new version
sudo a2dismod php7.3 #Disable old version
sudo a2enmod php8.0 #Enable new version
sudo systemctl restart apache2
````
#### Install base libraries
```` bash
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install curl php-cli php-mbstring php-xml git unzip
````

#### Install Composer (globally)
[Offical Docs](https://getcomposer.org/download/)

Composer is a dependency management tool in PHP. For any PHP project, you need to use a library of code.
```` bash
php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"
php -r "if (hash_file('sha384', 'composer-setup.php') === '756890a4488ce9024fc62c56153228907f1545c228516cbf63f885e036d37e9a59d27d63f46af1d4d07ee0f76181c7d3') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;"
php composer-setup.php
php -r "unlink('composer-setup.php');"
sudo mv composer.phar /usr/local/bin/composer #Make composer available globally
````
**Commands**
```` bash
composer update #Update composer
composer clear-cache #Clear cache
````
#### Create app
```` bash
composer create-project laravel/laravel example-app
````
**Specify version**
```` bash
composer create-project laravel/laravel=8 --prefer-dist example-app
````
#### Start server
```` bash
php artisan serve
````
**Specify socket**
```` bash
php artisan serve --host=127.0.0.1 --port=8002
````

#### Create database (in mysql)
```` sql
CREATE SCHEMA <dbname>;
GRANT ALL PRIVILEGES ON <dbname>.* TO 'username'@'localhost' IDENTIFIED BY 'password';
````

#### Create mysql user ad assign DB (in mysql)
```` sql
CREATE USER 'user'@'localhost' IDENTIFIED BY 'password';;
GRANT ALL PRIVILEGES ON * . * TO 'user'@'localhost';
FLUSH PRIVILEGES
````

**Then add the database configuration to the .env file**
The .env file contains all the private configuration data and is listed as gitignore so it is not made public by synchronizing it with Git. It's important to put all configuration data in that file and no other files.

#### Auth (Breeze)
Once you have created a new Laravel application, you may install Laravel Breeze using Composer.
```` bash
composer require laravel/breeze --dev
php artisan breeze:install
npm install
npm run dev
php artisan migrate
````

## Folder Structure
- **App**: Models, Controllers and Middleware
- **Config**: Configuration files
- **Database**: Migrations, Seeds
- **Public**: Css, Js
- **Resources**: Views
- **Vendor**: Installation files

## Naming Conventions

- **Controllers**: singular case, no spacing between words, and end with "Controller".
Ex: BlogController, AuthController, UserController.

- **Tables**: lower case, snake_case, plural form.
Ex: posts, project_tasks, uploaded_images.

- **Columns**: lower case, snake_case.
Ex: post_body, id, created_at.

- **Models**: singular, no spacing between words, capitalised.
Ex: User, ForumThread, Comment.

- **Blade**: lower case, snake_case
Ex: all.blade.php, all_posts.blade.php

## LAMP
LAMP (Linux, Apache, MySQL, PHP/Perl/Python) is an acronym denoting one of the most common solution stacks for many of the web's most popular applications. However, LAMP now refers to a generic software stack model and its components are largely interchangeable.

## CSRF
A CSRF token is a unique, secret, unpredictable value that is generated by the server-side application and transmitted to the client in such a way that it is included in a subsequent HTTP request made by the client. When the later request is made, the server-side application validates that the request includes the expected token and rejects the request if the token is missing or invalid. 

## MVC
All SQL statements can be generated and executed in only one place and the data  validation and manipulation can be applied in one place: the model. The controller will handle the request/response lifecycle, taking the input from the user interface (view) and updating model accordingly. 

## Create Controller
Simple controller:
````bash
php artisan make:controller Name
````
CRUD Controller:
````bash
php artisan make:controller --resource Name
````
## Create Model
Simple model:
````bash
php artisan make:model Name
````
Model and migration:
````bash
php artisan make:model Name -m
````
Model, migration and CRUD controller:
````bash
php artisan make:model Name -m -c --resource
````
## Create Migration
````bash
php artisan make:migration tablename
````
## Migrate
````bash
php artisan migrate
````
**Delete table**
````bash
php artisan migrate:reset
````
**Delete and create table**
````bash
php artisan migrate:refresh
````
**Specify only one migration**
````bash
php artisan migrate --path=/database/migrations/migration_name.php
````
````bash
php artisan migrate:refresh --path=/database/migrations/migration_name.php
````

## Clear cache
````bash
php artisan cache:clear
php artisan event:clear
php artisan route:clear
php artisan view:clear
php artisan config:clear
````
````bash
php artisan optimize:clear
````
## Routes
The web.php file in the routes directory is important. It takes the requests from you, the user, and sends them to either a closure that gives a response, a view page that displays the response, or a controller that does the same thing; in some critical cases, the controller consults with the model and then is updated by the business logic.

- Listing all the routes: `php artisan route:list`

**Route types:**
````php
Route::get($uri, $callback);
Route::post($uri, $callback);
Route::put($uri, $callback);
Route::patch($uri, $callback);
Route::delete($uri, $callback);
Route::options($uri, $callback);
````
**Redirect:**
````php
Route::redirect('/here', '/there');
````
````php
Route::permanentRedirect('/here', '/there');
````
````php
Route::redirect('/here', '/there', 301);
````
**Return function :**
````php
Route::get('/page', function () {
return view('helloworld');
});
````
**Return controller :**
````php
use App\Http\Controllers\UserController;

Route::get('/user', [UserController::class, 'index']);
````
**Return view:**
````php
Route::view('/welcome', 'welcome');
````
**Pass parameter to function:**
````php
Route::get('/user/{id}', function ($id) {
    return 'User '.$id;
});
````
**Pass parameter to controller:**
````php
Route::get('/user/{id}',[UserController::class, 'show']);
````
**Pass optional parameter to controller:**
- Note: use the same syntax to pass it to a function
````php
Route::get('/user/{id?}',[UserController::class, 'show']);
````
**Pass many parameters to controller:**
- Note: in the example there are both optional and required parameters. Use the same syntax to pass it to a controller
````php
Route::get('/posts/{post}/comments/{comment}', function ($postId, $commentId) {
    //
});
````
**Pass optional parameter to function with default value:**
````php
Route::get('/user/{name?}', function ($name = 'John') {
    return $name;
});
````
**Parameter validation:**
- The "where" method accepts the name of the parameter and a regular expression defining how the parameter should be constrained.
````php
Route::get('/user/{name}', function ($name) {
    //
})->where('name', '[A-Za-z]+');

Route::get('/user/{id}', function ($id) {
    //
})->where('id', '[0-9]+');

Route::get('/user/{id}/{name}', function ($id, $name) {
    //
})->where(['id' => '[0-9]+', 'name' => '[a-z]+']);
````
For convenience, some commonly used regular expression patterns have helper methods that allow you to quickly add pattern constraints to your routes:
````php
Route::get('/user/{id}/{name}', function ($id, $name) {
    //
})->whereNumber('id')->whereAlpha('name');

Route::get('/user/{name}', function ($name) {
    //
})->whereAlphaNumeric('name');

Route::get('/user/{id}', function ($id) {
    //
})->whereUuid('id');
````
**Route naming:**
- For functions:
````php
Route::get('/user/profile', function () {
    //
})->name('profile');
````
- For controllers:
````php
Route::get('/user/profile',[UserProfileController::class, 'show'])->name('profile');
````
- Get route by name (blade):
````html
<a href="{{route('home')}}">Link</a>
````
## Model
**Base model:** 
````php
class ModelName extends Model
{
    use HasFactory;
}
````
**Change table namel:** 
````php
protected $table = 'newname';
````
**Change primary key:** 
````php
protected $primaryKey = 'newname';
````
**Disable primary key integer incrementing:** 
````php
public $incrementing = false;
````
**Change primary key type:** 
````php
protected $keyType = 'string';
````
**Disable timestamps:** 
````php
public $timestamps = false;
````
## Views
I file di views terminano in .blade.php (non serve specificarlo quando si richiama la view).
Sarebbe possibile includere anche solo file .php o .html ma l'uso delle funzionalità messe a disposizione da blade è fortemente consigliato.

Link tra views
Basta linkare alla view voluta senza necessità di includere l'indirizzo completo
Es:
````html
<a href="/page1"> Pagina 1 </a>
````

### Blade
È un template engine. Quando viene richiamato, effettua una compilazione dalla sintassi blade ad un normale file php.
I file compilati si trovano in storage->framework->views.

#### Templating
Inserire contenuti in un certo punto: `@yield('content')`
Esempio layout:
````html
<!doctype html>

<title>Titolo</title>
<link rel="stylesheet" href="/css.css">

<body>
	@yield('content')
</body>

````

Estendere una vista per inserirci dentro dei contenuti: `@extends('layout')`.
Una volta esteso un file, tramite `@section` si crea una sezione che andà a prendere il posto di `@yield` nel file esteso.

Esempio vista:
````html
@extends('layout')

@section('content')
	<h1> Paragarfo 1 </h1>
	<p> testo </p>

@endsection

````

#### JS e CSS
I file di JS e Css inseriti nella cartella /resources/... verranno compilati e traferiti nella cartella public. 
Per saltare questo step è possibile inserire script e file css direttamente in public/...
Nelle views è possibile linkare direttamnte con: 
````html
<link rel="stylesheet" href="/css.css">
````

#### Dati da controller a views (compact)
Dal controller si richiama la views passando i parametri secondo la seguente sintassi:
````php
$testo = "Qualsiasi testo da passare alla view";
$testo2 = "Altro testo da passare";
return view('home',compact('testo','testo2'));
````
Nella view si inserisce un segnaposto secondo la sintassi:
````html
<p>{{$testo}}</p>
<h1>{{$testo2}}</h1>
````
In alternativa è possibile passare dati a views tramite la funzione With.



### Eloquent
Specifica chiave primaria:
 ````php
 protected $primaryKey = 'flight_id';
````
Eloquent assume che la chiave primaria sia auto increment. In caso contrario bisogna disattivare l'auto increment:
 ````php
public $incrementing = false;
````
Eloquent assume che la chiave primaria si di tipo integer. In caso contrario bisogna specificare il tipo:
 ````php
protected $keyType = 'string';	
````
Eloquent assume che siano presenti le colonne created_at e updated_at e le gestisce in automatico. In caso contrario specificare:
 ````php
public $timestamps = false;
````
Cambiare nome delle colonne che gestiscono i timestamps created_at e updated_at:
 ````php    
const CREATED_AT = 'creation_date';
const UPDATED_AT = 'updated_date';
````
Cambiare tipo delle colonne che gestiscono i timestamps created_at e updated_at:
 ````php    
protected $dateFormat = 'U';
````
Settare valori di default per alcuni attributi:
 ````php    
protected $attributes = [
	'delayed' => false,
];
````

Interrogazione semplice:
 ````php
 //The Eloquent all method will return all of the results in the model's table.
foreach (Flight::all() as $flight) {
    echo $flight->name;
}
````

Interrogazione condizionata: visita [Query Builder](https://laravel.com/docs/8.x/queries)

## Factory
Permette di generare dati di test da inserire nelle table create da migration. 
Si usa [Faker](https://github.com/fzaninotto/Faker) come libreria php per generare dati falsi.
Per creare Factory:
 ````bash
 php artisan make:factory UtenteFactory --model=Utente
````
Da laravel 8 è necessario aggiungere all'interno del file  di Factory:
````php
use Illuminate\Support\Str;
````
 e cambiare il percoso del Model come da esempio:
````php
    //Da laravel 8 cambiare da
	//protected $model = Utente::class; A:
    protected $model = \App\Models\Utente::class;
````

## Validazione
https://laravel.com/docs/8.x/validation

Per cambiare i messaggi di errore: resources/lang/en/validation.php


## Funzioni utili
`abort(404)` -> Abort e restituisce errore 404
`ddd(testo)` ->Die and Dump: Errore e mostra testo (usare solo in debug)
`return redirect('/homepage')` -> Reindirizza alla homepage




## Da studiare:
https://laravel.com/docs/8.x/csrf





